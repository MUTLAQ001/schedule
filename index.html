<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="راقب غيابك بأسلوب لم تره من قبل.">
	<meta name="theme-color" content="#0a0a0a">
	<title>حاسبة الغياب</title>
    <link id="favicon" rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0IDApIj48cmVjdCB4PSI2NCIgeT0iNDgiIHdpZHRoPSIzODQiIGhlaWdodD0iNDE2IiByeD0iNDAiIGZpbGw9IiMyMjI1MmQiLz48cmVjdCB4PSI5NiIgeT0iODAiIHdpZHRoPSIzMjAiIGhlaWdodD0iOTYiIHJ4PSIyMCIgZmlsbD0iIzVlOWNmZiIvPjxnIGZpbGw9IiM0YjUwNWEiPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjI0MCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSI0MjAiIHI9IjMyIi8%2BPC9nPjwvZz48L3N2Zz4%3D">
	<link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9%20%D8%A7%D9%84%D8%BA%D9%8A%D8%A7%D8%A8%22%2C%22short_name%22%3A%22%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9%20%D8%A7%D9%84%D8%BA%D9%8A%D8%A7%D8%A8%22%2C%22description%22%3A%22%D8%B1%D8%A7%D9%82%D8%A8%20%D8%BA%D9%8A%D8%A7%D8%A8%D9%8ك%20%D8%A8%D8%A3%D8%B3%D9%84%D9%88%D8%A8%20%D9%84%D9%85%20%D8%AA%D8%B1%D9%87%20%D9%85%D9%86%20%D9%82%D8%A8%D9%84.%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230a0a0a%22%2C%22theme_color%22%3A%22%230a0a0a%22%2C%22orientation%22%3A%22portrait-primary%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%3Bbase64%2CPHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI%2BPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0IDApIj48cmVjdCB4PSI2NCIgeT0iNDgiIHdpZHRoPSIzODQiIGhlaWdodD0iNDE2IiByeD0iNDAiIGZpbGw9IiMyMjI1MmQiLz48cmVjdCB4PSI5NiIgeT0iODAiIHdpZHRoPSIzMjAiIGhlaWdodD0iOTYiIHJ4PSIyMCIgZmlsbD0iIzVlOWNmZiIvPjxnIGZpbGw9IiM0YjUwNWEiPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjI0MCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSI0MjAiIHI9IjMyIi8%2BPC9nPjwvZz48L3N2Zz4%3D%22%2C%22sizes%22%3A%22192x192%20512x512%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%5D%7D">
	<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1 tribulationsPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0IDApIj48cmVjdCB4PSI2NCIgeT0iNDgiIHdpZHRoPSIzODQiIGhlaWdodD0iNDE2IiByeD0iNDAiIGZpbGw9IiMyMjI1MmQiLz48cmVjdCB4PSI5NiIgeT0iODAiIHdpZHRoPSIzMjAiIGhlaWdodD0iOTYiIHJ4PSIyMCIgZmlsbD0iIzVlOWNmZiIvPjxnIGZpbGw9IiM0YjUwNWEiPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjI0MCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNDAiIHI9IjMyIi8+PGNpcmNsZSBjeD0iMzYyIiBjeT0iMjQwIiByPSIzMiIvPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjMzMCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIzMzAiIHI9IjMyIi8+PGNpcmNsZSBjeD0iMzYyIiBjeT0iMzMwIiByPSIzMiIvPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjQyMCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSI0MjAiIHI9IjMyIi8+PGNpcmNsZSBjeD0iMzYyIiBjeT0iNDIwIiByPSIzMiIvPjwvZz48L2c+PC9zdmc+">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="حاسبة الغياب">
	<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<style>
		@import url("https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap");
		@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap");
		:root{--color-primary:#5e9cff;--color-primary-dark:#4b7dcc;--color-danger-red:#ff5252;--color-warning-gold:#ffc400;--color-save-green:#00c853;--color-bg:#0a0a0a;--color-card:rgba(20,20,22,0.75);--color-border:rgba(255,255,255,0.1);--color-text:#e0e0e0;--color-text-muted:#999;--font-body:"Cairo",sans-serif;--font-title:"IBM Plex Sans Arabic",sans-serif;--radius:20px;--radius-md:16px;--radius-full:999px;--transition:0.3s cubic-bezier(0.25,0.8,0.25,1);--transition-smooth:0.5s cubic-bezier(0.2,0.8,0.2,1);--rgb-primary:94,156,255;--rgb-warning:255,196,0;--rgb-danger:255,82,82;--primary-hue:217;--secondary-hue:257;}
		* {
			margin:0;
			padding:0;
			box-sizing:border-box;
			-webkit-tap-highlight-color: transparent;
		}
		html{
			scroll-behavior:smooth;
			scrollbar-gutter: stable;
			scrollbar-width: none; /* Hide scrollbar for Firefox */
		}
		body.modal-open { 
            overflow: hidden !important;
        }
		body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) {
			overflow-y: hidden !important;
		}

		/* Hide scrollbars for all browsers */
		::-webkit-scrollbar {
			display: none;
		}
		
        @keyframes gradient-animation{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
		@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
		@keyframes scaleIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
		@keyframes fadeIn{from{opacity:0}to{opacity:1}}
		@keyframes glow-update{0%{box-shadow:0 0 0 0 rgba(var(--rgb-primary),0)}50%{box-shadow:0 0 20px 5px rgba(var(--rgb-primary),0.4)}100%{box-shadow:0 0 0 0 rgba(var(--rgb-primary),0)}}
		@keyframes swal-scale-in { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
		@keyframes swal-scale-out { from { transform: scale(1); opacity: 1; } to { transform: scale(0.9); opacity: 0; } }
		@keyframes move-nebula{0%{transform:translate(0,0) rotate(0deg) scale(1.2)}50%{transform:translate(10vw,5vh) rotate(180deg) scale(1.5)}100%{transform:translate(0,0) rotate(360deg) scale(1.2)}}
		
		*:focus-visible{outline:2px solid var(--color-primary);outline-offset:3px;border-radius:6px}
        .swal-popup-animation-in { animation: swal-scale-in 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
		.swal-popup-animation-out { animation: swal-scale-out 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) forwards; }
		body{font-family:var(--font-body);background-color:var(--color-bg);color:var(--color-text);direction:rtl;overflow-x:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale; transition: background-color var(--transition-smooth), color var(--transition-smooth); -ms-overflow-style: none; /* Hide scrollbar for IE & Edge */}
		
        .cosmic-bg-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;overflow:hidden}
		#starfield-canvas{position:absolute;top:0;left:0;width:100%;height:100%}
		.nebula-glow{position:absolute;top:50%;left:50%;width:80vmax;height:80vmax;margin-top:-40vmax;margin-left:-40vmax;background:radial-gradient(circle,hsl(var(--primary-hue),90%,60%,.15) 0%,hsl(var(--secondary-hue),80%,50%,.1) 40%,transparent 70%);filter:blur(100px);border-radius:50%;animation:move-nebula 90s infinite alternate ease-in-out;transition:opacity .5s ease,background .5s ease}
		.light-mode .nebula-glow{opacity:.5;filter:blur(120px)}
		
        .app{min-height:100vh;position:relative;padding:2rem 1rem;}
		.container{width:100%;max-width:600px;z-index:1;display:flex;flex-direction:column;gap:1.5rem;margin:0 auto;position:relative}
		.header{text-align:center;animation:fadeInUp .8s var(--transition-smooth) both}
		.title{font-family:var(--font-title);font-weight:700;font-size:2.8rem;margin-bottom:0.25rem;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:200% 200%;animation:gradient-animation 5s ease-in-out infinite;}
		.subtitle{color:var(--color-text-muted);font-size:1rem;animation:fadeInUp .8s var(--transition-smooth) .2s both; letter-spacing: 0.5px;}

        .card{
            background:var(--color-card);
            border:1px solid var(--color-border);
            border-radius:var(--radius);
            padding:1.5rem;
            backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
            transition: background-color var(--transition-smooth), border-color var(--transition-smooth), box-shadow var(--transition-smooth);
            position:relative;
            animation:scaleIn .8s var(--transition-smooth) .4s both;
            box-shadow: 0 16px 40px -12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
        }
		.card.safe{--status-color:var(--color-primary);--rgb-status:var(--rgb-primary)}
		.card.warning{--status-color:var(--color-warning-gold);--rgb-status:var(--rgb-warning)}
		.card.danger{--status-color:var(--color-danger-red);--rgb-status:var(--rgb-danger)}
		.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--color-border); transition: border-color var(--transition-smooth);}
		.card-header h2{font-family:var(--font-title);font-weight:700;font-size:1.7rem;color:#fff;display:flex;align-items:center;gap:0.75rem; transition: color var(--transition-smooth);}
		.card-header-controls{display:flex;align-items:center;gap:0.5rem;}
		
		.input-grid{
			display: grid;
			grid-template-columns: 1fr;
			gap: 1.5rem;
			padding-top: 0.5rem;
		}
		
		.label-with-icon-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
			margin-bottom: 0.5rem;
        }
		.label-with-icon-container label {
			margin-bottom: 0;
		}
		
		.input-group label{display:block;font-size:.9rem;color:var(--color-text-muted); transition: color var(--transition-smooth); margin-bottom: 0.5rem;}
		.input-group input{width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);border-radius:var(--radius-full);padding:.9rem 1.2rem;color:var(--color-text);font-family:var(--font-body);font-size:1rem;transition: background-color var(--transition-smooth), border-color var(--transition-smooth), color var(--transition-smooth);}
		.input-group input:focus{outline:none;border-color:var(--status-color,var(--color-primary));box-shadow:0 0 0 3px rgba(var(--rgb-status, var(--rgb-primary)), 0.4);transition: border-color var(--transition), box-shadow var(--transition);}
		.input-hint { font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.5rem; text-align: right; transition: color var(--transition-smooth); font-weight: 400; opacity: 0.8; }
		
		input:-webkit-autofill,
		input:-webkit-autofill:hover, 
		input:-webkit-autofill:focus, 
		input:-webkit-autofill:active {
			-webkit-box-shadow: 0 0 0 40px rgba(0,0,0,0.3) inset !important;
			box-shadow: 0 0 0 40px rgba(0,0,0,0.3) inset !important;
			-webkit-text-fill-color: var(--color-text) !important;
			transition: background-color 5000s ease-in-out 0s;
			border-color: var(--color-border) !important;
		}

		.light-mode input:-webkit-autofill,
		.light-mode input:-webkit-autofill:hover, 
		.light-mode input:-webkit-autofill:focus, 
		.light-mode input:-webkit-autofill:active {
			-webkit-box-shadow: 0 0 0 40px rgba(0,0,0,0.04) inset !important;
			box-shadow: 0 0 0 40px rgba(0,0,0,0.04) inset !important;
			border-color: rgba(0,0,0,0.08) !important;
		}
		
		.absence-control { display:flex; align-items: stretch; background:rgba(0,0,0,0.3); border:1px solid var(--color-border); border-radius:var(--radius-full); overflow:hidden; transition: background-color var(--transition-smooth), border-color var(--transition-smooth); }
		.absence-control input { flex-grow: 1; border: none !important; border-left: 1px solid var(--color-border); border-right: 1px solid var(--color-border); background: transparent !important; text-align: center; box-shadow: none !important; padding: .9rem .25rem; transition: border-color var(--transition-smooth), color var(--transition-smooth); color: var(--color-text); }
		.absence-control button { position: relative; z-index: 1; background: transparent; border: none; color: var(--color-text); font-size: 1.5rem; cursor: pointer; padding: 0 1.2rem; transition: color var(--transition-smooth), transform .2s ease; line-height: 1; display: flex; align-items: center; user-select: none; }
		.absence-control button:active { transform:scale(.95); }
		.absence-control input::-webkit-inner-spin-button, .absence-control input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
		.absence-control input{-moz-appearance:textfield}
		.absence-control button::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: -1; opacity: 0; transition: opacity var(--transition); }
		.absence-control button:hover:not(:disabled) { color: var(--color-primary); transform: scale(1.1); }
		.absence-control button:hover:not(:disabled)::before { opacity: 1; }
		.absence-control button:first-of-type::before { background: linear-gradient(to left, rgba(var(--rgb-primary), 0.3) 0%, transparent 80%); }
		.absence-control button:last-of-type::before { background: linear-gradient(to right, rgba(var(--rgb-primary), 0.3) 0%, transparent 80%); }
		
		.action-picker-wrapper { position: relative; width: 100%; }
		.action-picker-display {
			width: 100%;
			padding: .9rem 1.2rem;
			font-family: var(--font-body);
			font-size: 1rem;
			color: var(--color-text);
			background: rgba(0,0,0,0.3);
			border: 1px solid var(--color-border);
			border-radius: var(--radius-full);
			cursor: pointer;
			transition: all var(--transition);
			text-align: center;
		}
		.action-picker-display:hover { border-color: var(--color-primary); }
		
		.action-picker-panel {
			position: absolute;
			top: calc(100% + 8px);
			left: 0;
			right: 0;
			z-index: 10;
			background-color: rgba(20,20,22,0.9);
			border: 1px solid var(--color-border);
			border-radius: var(--radius-md);
			padding: 0.5rem;
			box-shadow: 0 10px 30px rgba(0,0,0,0.3);
			backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
			animation: scaleIn 0.2s ease-out;
			transform-origin: top center;
			max-height: 250px;
			overflow-y: auto;
			scrollbar-width: none;
		}
		.action-picker-option {
			width: 100%;
			padding: 0.8rem 1rem;
			font-family: var(--font-body);
			font-size: 1rem;
			color: var(--color-text-muted);
			background-color: transparent;
			border-radius: var(--radius-full);
			border: none;
			cursor: pointer;
			transition: all var(--transition);
			text-align: center;
		}
		.action-picker-option:hover { background-color: rgba(var(--rgb-primary), 0.1); }
		.action-picker-option.selected {
			color: var(--color-primary);
			font-weight: 700;
			background-color: transparent;
		}
		.action-picker-option.selected:hover {
			background-color: rgba(var(--rgb-primary), 0.15);
		}

		.divider{height:1px;background:var(--color-border);margin:1.5rem 0; transition: background-color var(--transition-smooth);}
		.save-button{width:100%;padding:1rem;font-family:var(--font-body);font-size:1.1rem;font-weight:600;border:none;border-radius:var(--radius-full);cursor:pointer;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));color:#fff;transition:all .2s ease-in-out;display:flex;justify-content:center;align-items:center;gap:.75rem;user-select:none; margin-top: 1.5rem;}
		.save-button:hover{transform:translateY(-3px);box-shadow:0 4px 15px rgba(var(--rgb-primary),0.25); filter: brightness(1.1);}
		.save-button:active{transform:translateY(-1px) scale(.98)}
		.view-list-btn { background: rgba(var(--rgb-primary), 0.1); border: 1px solid var(--color-border); border-radius: var(--radius-full); padding: 0.8rem 1.5rem; color: var(--color-primary); font-family: var(--font-body); font-size: 1rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.75rem; cursor: pointer; transition: background-color var(--transition-smooth), color var(--transition-smooth), border-color var(--transition-smooth), transform var(--transition), box-shadow var(--transition); animation: scaleIn .8s var(--transition-smooth) .3s both; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .view-list-btn:hover { background: rgba(var(--rgb-primary), 0.2); border-color: var(--color-primary); transform: translateY(-2px); }
		.course-list-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:1.5rem;padding-bottom:1.5rem;border-bottom:1px solid var(--color-border); transition: border-color var(--transition-smooth);}
		.list-controls{display:flex;gap:.75rem;align-items:center}
		.list-controls .control-btn{position:relative;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);color:var(--color-text);border-radius:var(--radius-full);cursor:pointer;transition:var(--transition-smooth);display:flex;align-items:center;font-size:1rem;gap:.5rem;padding:0 .5rem 0 1rem}
		.list-controls .control-btn:hover{border-color:var(--color-primary);color:var(--color-text)}
		.list-controls .control-btn select{color:var(--color-text);background:transparent;border:none;outline:none;padding:.5rem 2rem .5rem .5rem;font-family:var(--font-body);font-size:1rem;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer; transition: color var(--transition-smooth);}
		.list-controls .control-btn .sort-icon{position:absolute;right:1rem;pointer-events:none}
		
		.course-list{display:flex;flex-direction:column;gap:1rem}
		
		/* --- START: Final Professional Styling --- */
		.course-item {
			display: flex;
			flex-direction: column;
			gap: 0.75rem;
			padding: 1.25rem;
			background: var(--color-card);
			border: 1px solid var(--color-border);
			border-radius: var(--radius-md);
			transition: all .4s cubic-bezier(0.2, 0.8, 0.2, 1);
			opacity:0;
			animation:fadeInUp .5s ease both;
			position: relative;
			overflow: hidden;
			box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.07), 0 8px 25px -10px rgba(0,0,0,0.4);
		}

		.course-item::before {
			content: '';
			position: absolute;
			inset: 0;
			border-radius: var(--radius-md);
			background: radial-gradient(circle at 100% 0, rgba(var(--rgb-status), 0.12) 0%, transparent 40%);
			opacity: 0;
			transition: opacity 0.5s ease, background 0.5s ease;
			z-index: 1;
		}

		.course-item.safe::before,
		.course-item.warning::before,
		.course-item.danger::before {
			opacity: 1;
		}

		.course-top-row, .course-progress, .course-meta {
			position: relative;
			z-index: 2;
		}

		.course-item.updated{animation:glow-update 1.5s ease-out,fadeInUp .5s ease both}
		.course-item.safe{--status-color:var(--color-primary); --rgb-status:var(--rgb-primary)}
		.course-item.warning{--status-color:var(--color-warning-gold); --rgb-status:var(--rgb-warning)}
		.course-item.danger{--status-color:var(--color-danger-red); --rgb-status:var(--rgb-danger)}

		.course-item:hover {
			transform: translateY(-5px);
			box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.07), 
						0 0 25px -4px rgba(var(--rgb-status), 0.4),
						0 12px 30px -10px rgba(0,0,0,0.5);
		}

		.course-item:hover::before {
			background: radial-gradient(circle at 100% 0, rgba(var(--rgb-status), 0.25) 0%, transparent 50%);
		}

		.course-top-row { display: flex; justify-content: space-between; align-items: start; gap: 1rem; }
		.course-info { flex-grow: 1; min-width: 0; }
		.course-info h3{font-family:var(--font-title);font-size:1.3rem;font-weight:400;color:#fff; transition: color var(--transition-smooth); margin-bottom: 0.1rem;}
		.course-info p{color:var(--color-text-muted);font-size:0.8rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis; transition: color var(--transition-smooth);}
		.course-actions{ flex-shrink: 0; display:flex; gap:.5rem; align-items: center; }
		.course-actions button{background:none;border:none;color:var(--color-text-muted);font-size:1.2rem;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;padding:0.25rem}
		.course-actions button:hover{color:#fff;transform:scale(1.1)}
		.course-actions button[title=تعديل]:hover{color:var(--color-primary)}
		.course-actions button[title=حذف]:hover{color:var(--color-danger-red)}
		
		.course-progress{width: 100%; height:8px; background:rgba(255,255,255,0.08);border-radius:4px;transition:background-color var(--transition-smooth);overflow:hidden;}
		.course-progress-bar{height:100%;background:var(--status-color,var(--color-primary));transition:width var(--transition-smooth),background-color var(--transition-smooth)}

		.course-meta{width: 100%; font-size:.8rem;color:var(--color-text-muted);display:flex;justify-content:space-between;align-items:center}
		.meta-info{display:flex;align-items:center;gap:0.75rem}
		.quick-add-controls { display: flex; gap: 0.5rem; }
		.quick-add-btn { background-color: rgba(255, 255, 255, 0.05); border: 1px solid var(--color-border); color: var(--color-text-muted); font-size: 0.8rem; font-weight: bold; cursor: pointer; border-radius: 6px; padding: 0.2rem 0.6rem; transition: all var(--transition); user-select: none; }
		.quick-add-btn:hover { background-color: rgba(var(--rgb-primary), 0.2); border-color: var(--color-primary); color: var(--color-primary); transform: scale(1.05); }
		.quick-add-btn:active { transform: scale(0.95); }
		/* --- END: Final Professional Styling --- */

		.footer{text-align:center;color:var(--color-text-muted);font-size:1rem;display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid var(--color-border);animation:fadeInUp .8s var(--transition-smooth) .8s both; transition: color var(--transition-smooth), border-color var(--transition-smooth);}
		.footer-controls{display:flex;align-items:center;gap:0.5rem;}
		.footer-link-text{color:var(--color-text-muted);transition:color var(--transition);text-decoration:none;font-size:1rem;}
		.footer-link-text:hover{color:var(--color-text)}
		.footer-icon-btn {
			background: transparent;
			border: none;
			color: var(--color-text-muted);
			font-size: 1.5rem;
			cursor: pointer;
			transition: all 0.2s ease-in-out;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			width: 44px;
			height: 44px;
			border-radius: 50%;
			text-decoration: none;
		}
		.footer-icon-btn:hover {
			color: var(--color-primary);
			background-color: rgba(var(--rgb-primary), 0.1);
			transform: scale(1.1);
		}

		.header-icon-btn {background:none;border:none;color:var(--color-text-muted);font-size:1.5rem;cursor:pointer;transition:color var(--transition), transform var(--transition);display:flex;align-items:center;justify-content:center;padding:0.25rem;}
        .header-icon-btn:hover{color:var(--color-primary);transform:scale(1.1)}
		.clear-button:hover{transform:rotate(90deg) scale(1.1)}
		
		.info-tooltip-wrapper{position:relative;display:flex;align-items:center;color:var(--color-text-muted);cursor:help;}
		.info-tooltip-wrapper > svg { color: var(--color-warning-gold); transition: transform 0.2s ease; }
		.info-tooltip-wrapper:hover > svg { transform: scale(1.15) rotate(10deg); }
		.info-tooltip-wrapper .info-tooltip {
			visibility: hidden;
			opacity: 0;
			width: 280px;
			background-color: var(--color-card);
			color: var(--color-text);
			border: 1px solid var(--color-border);
			text-align: right;
			border-radius: var(--radius-md);
			padding: 1rem;
			position: absolute;
			z-index: 10;
			bottom: 125%;
			left: 0;
			transform: none;
			transition: opacity .3s, background-color var(--transition-smooth), border-color var(--transition-smooth), color var(--transition-smooth);
			font-size: 0.85rem;
			line-height: 1.7;
			box-shadow: 0 8px 25px rgba(0,0,0,0.3);
			backdrop-filter: blur(12px);
			-webkit-backdrop-filter: blur(12px);
		}
		.info-tooltip-wrapper .info-tooltip::after {
			content: "";
			position: absolute;
			top: 100%;
			left: 10px;
			margin-left: 0;
			border-width: 6px;
			border-style: solid;
			border-color: var(--color-card) transparent transparent transparent;
			transition: border-color var(--transition-smooth);
		}
		.info-tooltip-wrapper:hover .info-tooltip { visibility:visible; opacity:1; }
		.light-mode .info-tooltip-wrapper .info-tooltip { box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
		
		.result-section{display:flex; flex-direction: column; align-items:center;gap:1.5rem;margin-top:1.5rem;padding:1.5rem;border-radius:var(--radius);animation:fadeInUp .6s ease both;transition:background .4s ease;background:radial-gradient(circle,rgba(var(--rgb-status,var(--rgb-primary)),0.1) 0%,transparent 70%),rgba(0,0,0,0.2)}
		.chart-container{position:relative;min-width:120px;height:120px}
		.donut-chart{width:100%;height:100%;transform:rotate(-90deg)}
		.donut-chart-bg{fill:none;stroke:var(--color-border);stroke-width:10; transition: stroke var(--transition-smooth);}
		.donut-chart-fg{fill:none;stroke-width:10;stroke-linecap:round;transition:stroke-dashoffset 0.6s cubic-bezier(0.215, 0.61, 0.355, 1), stroke 0.4s ease}
		.donut-chart-fg.safe{stroke:var(--color-primary)}
		.donut-chart-fg.warning{stroke:var(--color-warning-gold)}
		.donut-chart-fg.danger{stroke:var(--color-danger-red)}
		.chart-info{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}
		.chart-info span{font-family:var(--font-title);font-weight:700;font-size:2rem;color:#fff;line-height:1.1; transition: color var(--transition-smooth);}
		.chart-info p{font-size:.8rem;color:var(--color-text-muted);margin-top:0.25rem; transition: color var(--transition-smooth);}
		.result-details{flex:1; width: 100%; display: flex; flex-direction: column; gap: 0.5rem;}
		.detail-item{display:flex;justify-content:space-between;align-items:baseline;padding:.5rem 0;font-size:.9rem}
		.detail-item strong{font-size:1.1rem;color:#fff; transition: color var(--transition-smooth);}

		.predictive-text, .denial-message {
			margin-top: 1rem;
			padding: .75rem 1rem;
			border-radius: var(--radius-full);
			font-weight: 600;
			transition: all var(--transition-smooth);
			position: relative;
			overflow: hidden;
			border: 1px solid transparent;
		}
		.predictive-text {
			text-align: center;
			color: var(--status-color, var(--color-text));
			background: rgba(var(--rgb-status, var(--rgb-primary)), 0.1);
			border-color: rgba(var(--rgb-status, var(--rgb-primary)), 0.2);
		}
		.denial-message {
			display: flex;
			align-items: center;
			gap: 1rem;
			background: rgba(var(--rgb-danger), 0.15);
			border-color: rgba(var(--rgb-danger), 0.25);
			padding: 1rem 1.25rem;
		}
		.denial-icon{color:var(--color-danger-red);font-size: 2rem;flex-shrink:0;}
		.denial-text-content{flex-grow: 1;}
		.denial-title{font-family:var(--font-title);font-weight:700;color:#fff;font-size:1.2rem;margin:0;line-height:1.2;transition:color var(--transition-smooth);}
		.denial-subtitle{font-size:.9rem;color:var(--color-text-muted);margin-top:.15rem;display: block;transition: color var(--transition-smooth);}

		.empty-list-message{text-align:center;padding:3rem 2rem;color:var(--color-text-muted);border:2px dashed var(--color-border);border-radius:var(--radius);display:flex;flex-direction:column;align-items:center;gap:1.5rem; transition: border-color var(--transition-smooth), color var(--transition-smooth);}
		.empty-list-message svg{font-size:4rem;color:var(--color-primary);opacity:0.5}
		.empty-list-message h3 { font-family: var(--font-title); font-size: 1.4rem; color: var(--color-text); transition: color var(--transition-smooth); }
		.empty-list-message p { font-size: 1rem; max-width: 300px; line-height: 1.7; }
		
		/* --- START: Absence Table Modal --- */
		.swal-table-container {
            max-height: 45vh;
            overflow-y: auto;
            margin-top: 1rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            scrollbar-width: none;
        }
        .swal-info-table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }
        .swal-info-table th, .swal-info-table td {
            padding: 0.9rem 0.5rem;
            border-bottom: 1px solid var(--color-border);
        }
        .swal-info-table thead th {
            font-family: var(--font-title);
            color: var(--color-primary-dark);
            position: sticky;
            top: 0;
            background: var(--color-card);
			z-index: 1;
            border-bottom-width: 2px;
            border-bottom-color: var(--color-border);
        }
        .swal-info-table tbody tr:last-child td {
            border-bottom: none;
        }
        .swal-info-table tbody tr:nth-child(even) {
            background-color: rgba(255,255,255,0.03);
        }
        .light-mode .swal-info-table tbody tr:nth-child(even) {
            background-color: rgba(0,0,0,0.03);
        }
        .swal-info-table .col-hours {
            font-weight: 700;
            color: var(--color-text);
        }
        .swal-info-table .col-allowed {
            color: var(--color-primary);
            font-weight: 600;
        }
        .swal-info-table .col-denial {
            color: var(--color-danger-red);
            font-weight: 700;
        }
        .swal-popup-table-compact {
            padding-bottom: 1.5rem !important;
        }
		/* --- END: Absence Table Modal --- */
		
		/* --- START: CSS Changes for compact explanation modal --- */
		.swal-popup.swal-popup-explanation-compact {
            padding-top: 1.25rem !important;
            padding-bottom: 1.5rem !important;
        }
        .swal-popup-explanation-compact .swal-explanation-content p {
            margin: 0 0 0.75rem 0;
            line-height: 1.7;
        }
        .swal-popup-explanation-compact .swal-explanation-content hr {
            margin: 1rem 0;
        }
		.swal-popup-explanation-compact .swal-explanation-content h4 {
            margin-bottom: 0.25rem;
        }
        .swal-popup-explanation-compact .swal-explanation-content .swal-tip {
            margin-top: 1.25rem;
        }
		/* --- END: CSS Changes --- */
        .swal-explanation-content { text-align: right; line-height: 1.8; font-size: 1rem; }
        .swal-explanation-content p { margin: 0 0 1rem 0; }
        .swal-explanation-content h4 { font-family: var(--font-title); font-size: 1.1rem; font-weight: 600; color: var(--color-text); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.6rem; }
        .swal-explanation-content .swal-example-box { margin-top: 0.5rem; background: rgba(var(--rgb-primary), 0.05); border: 1px solid rgba(var(--rgb-primary), 0.15); padding: 0.75rem 1rem; border-radius: var(--radius-md); font-size: 0.95rem; line-height: 1.7; }
        .swal-explanation-content hr { border: none; height: 1px; background: var(--color-border); margin: 1.5rem 0; }
        .swal-explanation-content .swal-tip { text-align: center; color: var(--color-primary); font-weight: 600; font-size: 0.9rem; margin-top: 1rem; margin-bottom: 0; }
        .light-mode .swal-explanation-content .swal-example-box { background: rgba(0,0,0,0.05); }
        .highlight-weeks {
            color: var(--color-primary);
            font-weight: 700;
        }
		.swal-explanation-content .swal-example-box ul {
			list-style-position: inside;
			padding-right: 0;
		}
		.swal-explanation-content .swal-example-box li {
			margin-bottom: 0.25rem;
		}


		.swal2-popup{background:var(--color-card)!important;color:var(--color-text)!important;border-radius:var(--radius)!important;border:1px solid var(--color-border)!important; transition: background-color var(--transition-smooth), color var(--transition-smooth), border-color var(--transition-smooth); backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);}
		.swal2-title{color:var(--color-text)!important; font-family: var(--font-title) !important; transition: color var(--transition-smooth) !important;}
		.swal2-html-container{color:var(--color-text-muted)!important; transition: color var(--transition-smooth) !important; margin: 1em 0 !important; font-size: 1em !important; display: block !important; }
		.swal2-confirm{background:var(--color-primary)!important;border-radius:var(--radius-full)!important;padding:.6rem 1.5rem!important;font-family:var(--font-body)!important;transition: background-color var(--transition-smooth) !important;}
		.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(var(--rgb-primary),0.5)!important}
		.swal2-cancel{background:rgba(255,255,255,0.1)!important;color:var(--color-text)!important;border-radius:var(--radius-full)!important;padding:.6rem 1.5rem!important;font-family:var(--font-body)!important; transition: background-color var(--transition-smooth), color var(--transition-smooth) !important;}
		
		/* START: Toast Improvement */
		.swal2-toast {
			border-radius: var(--radius-md) !important;
			border: 1px solid var(--color-border) !important;
			padding: 0.75rem 1rem !important;
			transition: background-color var(--transition-smooth), border-color var(--transition-smooth);
			box-shadow: 0 5px 20px rgba(0,0,0,0.2);
			display: flex !important;
			align-items: center !important;
			gap: 0.75rem !important;
		}
		.swal2-toast .swal2-title {
			font-size: 1rem !important;
			margin: 0 !important;
			padding: 0 !important;
			text-align: right !important;
			color: var(--color-text) !important;
		}
		.swal2-toast .swal2-icon {
			margin: 0 !important;
			width: 2em !important;
			height: 2em !important;
			align-self: center !important;
		}
		.swal2-icon.swal2-success .swal2-success-line-tip,
		.swal2-icon.swal2-success .swal2-success-line-long {
			stroke-width: 3px !important;
		}
		.swal2-icon.swal2-warning .swal2-icon-content {
			font-size: 2.2rem !important;
		}
		/* END: Toast Improvement */

		.swal2-timer-progress-bar { background: linear-gradient(to right, var(--color-primary), var(--color-primary-dark)); height: 4px !important; }
		.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; animation: fadeIn .3s ease forwards; transition: background-color var(--transition-smooth); }
		.modal-content { background: var(--color-card); border: 1px solid var(--color-border); border-radius: var(--radius); padding: 1.5rem; width: 90%; max-width: 500px; z-index: 1001; transform: scale(0.95); opacity: 0; animation: scaleIn .3s .1s ease forwards; position: relative; backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px); transition: background-color var(--transition-smooth), border-color var(--transition-smooth); }
		.modal-close-btn { position: absolute; top: 1rem; left: 1rem; background: none; border: none; color: var(--color-text-muted); font-size: 1.8rem; cursor: pointer; transition: var(--transition); padding: 0.25rem; line-height: 1; }
		.modal-close-btn:hover { color: #fff; transform: rotate(90deg); }
		.modal-header { font-family: var(--font-title); font-size: 1.5rem; color: #fff; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border); transition: color var(--transition-smooth), border-color var(--transition-smooth); }
		
		/* --- START: Settings Layout - Clean & Simple --- */
		.settings-content { display: flex; flex-direction: column; gap: 1rem; text-align: right; }
		.settings-section { display: flex; flex-direction: column; gap: 1rem; }
		.settings-section-title { font-family: var(--font-title); font-size: 1.2rem; color: var(--color-primary); margin-bottom: 0; padding-bottom: 0.75rem; border-bottom: 1px solid var(--color-border); transition: color var(--transition-smooth), border-color var(--transition-smooth); }

		.settings-item {
			display: flex;
			flex-wrap: wrap;
			justify-content: space-between;
			align-items: center;
			gap: 1rem;
		}
        .settings-item h4 { font-family: var(--font-body); font-weight: 600; font-size: 1rem; color: var(--color-text); transition: color var(--transition-smooth); margin: 0; }
		.settings-item p { font-size: 0.8rem; color: var(--color-text-muted); margin: 0; line-height: 1.5; flex-grow: 1; }

		.theme-picker{display:flex;gap:.5rem;align-items:center; flex-shrink: 0;}
		.theme-dot{width:24px;height:24px;border-radius:50%;cursor:pointer;transition:transform .2s ease, border-color .2s ease;border:2px solid transparent}
		.theme-dot:hover{transform:scale(1.2)}
		.theme-dot.active{border-color:#fff; transform: scale(1.1);}
        .color-picker-label { position: relative; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; transition: all .2s ease; border: 2px solid var(--color-border); user-select: none; overflow: hidden; }
        .color-picker-label:hover { transform: scale(1.2); }
        .color-picker-label.active { border-color: #fff; transform: scale(1.1); }
        .color-picker-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; border: none; padding: 0; cursor: pointer; }
		
		.data-management-zone { border: 1px solid rgba(var(--rgb-warning), 0.3); border-radius: var(--radius-md); padding: 1.25rem; margin-top: 1rem; background: rgba(var(--rgb-warning), 0.05); }
		.data-management-zone .settings-item { flex-direction: column; align-items: flex-start; }
		.data-management-zone-btn { align-self: flex-end; margin-top: 0.5rem; background: transparent; color: var(--color-danger-red); border: 1px solid rgba(var(--rgb-danger), 0.5); padding: 0.6rem 1.2rem; border-radius: var(--radius-full); font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: var(--transition); }
		.data-management-zone-btn:hover { background: rgba(var(--rgb-danger), 0.2); color: #fff; border-color: var(--color-danger-red); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(var(--rgb-danger), 0.2); }
		/* --- END: Settings Layout --- */
		
		.recommendation-message {
			--rgb-status: var(--rgb-primary);
			display: flex;
			align-items: center;
			gap: 0.75rem;
			padding: 0.75rem 1rem;
			border-radius: var(--radius-full);
			margin-top: 1rem;
			font-size: 0.9rem;
			font-weight: 600;
			transition: all 0.3s ease;
			border: 1px solid transparent;
			box-shadow: 0 4px 15px -5px rgba(var(--rgb-status), 0.2);
		}
		.recommendation-message.correct {
			--rgb-status: var(--rgb-primary);
			background: rgba(var(--rgb-primary), 0.1);
			border-color: rgba(var(--rgb-primary), 0.2);
			color: var(--color-primary);
		}
		.recommendation-message.warning {
			--rgb-status: var(--rgb-warning);
			background: rgba(var(--rgb-warning), 0.1);
			border-color: rgba(var(--rgb-warning), 0.2);
			color: var(--color-warning-gold);
		}
		
		.install-app-btn { width: 100%; padding: .8rem; font-family: var(--font-body); font-size: 1.1rem; font-weight: 600; border: none; border-radius: var(--radius-full); cursor: pointer; background: var(--color-save-green); color: #fff; transition: all .2s ease-in-out; display: flex; justify-content: center; align-items: center; gap: .75rem; user-select: none; }
		.install-app-btn:hover { filter: brightness(1.1); transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,200,83,0.3); }
		
		.mode-toggle { display: flex; background: rgba(0,0,0,0.3); border: 1px solid var(--color-border); border-radius: var(--radius-full); padding: 4px; gap: 4px; transition: var(--transition-smooth); }
		.mode-btn { padding: 0.4rem 1rem; border: none; border-radius: var(--radius-full); font-family: var(--font-body); font-size: 0.9rem; font-weight: 600; cursor: pointer; background: transparent; color: var(--color-text-muted); transition: all 0.2s ease; user-select: none; }
		.mode-btn.active { background: var(--color-primary); color: #fff; box-shadow: 0 2px 5px rgba(var(--rgb-primary), 0.2); }

		.light-mode { --color-bg: #f9f9f9; --color-card: rgba(255, 255, 255, 0.75); --color-border: rgba(0, 0, 0, 0.09); --color-text: #202020; --color-text-muted: #707070; }
		.light-mode .card { box-shadow: 0 16px 40px -12px rgba(0,0,0,0.1); }
		.light-mode .card-header h2, .light-mode .course-info h3, .light-mode .detail-item strong, .light-mode .chart-info span, .light-mode .denial-title, .light-mode .modal-header, .light-mode .settings-item h4, .light-mode .stepper-control .stepper-value { color: var(--color-text); }
		.light-mode .input-group input, .light-mode .action-picker-display { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); color: var(--color-text); }
		.light-mode .input-group input:focus { background-color: rgba(255,255,255,0.5); border-color: var(--color-primary); }
		.light-mode .action-picker-panel { background-color: rgba(255, 255, 255, 0.9); }
		.light-mode .action-picker-option { color: var(--color-text-muted); }
		.light-mode .action-picker-option.selected { 
			color: var(--color-primary);
			background-color: transparent;
		}
		.light-mode .action-picker-option.selected:hover {
			background-color: rgba(var(--rgb-primary), 0.1);
		}
		.light-mode .action-picker-option:hover {
			background-color: rgba(var(--rgb-primary), 0.1);
			color: var(--color-text);
		}
		.light-mode .absence-control, .light-mode .stepper-control { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); }
		.light-mode .absence-control button, .light-mode .stepper-control button { color: var(--color-text-muted); }
		.light-mode .save-button:hover { box-shadow: 0 4px 15px rgba(var(--rgb-primary),0.35); }
		.light-mode .view-list-btn { background: var(--color-card); box-shadow: 0 4px 10px rgba(0,0,0,0.05); color: var(--color-primary); }
		.light-mode .view-list-btn:hover { background: rgba(255,255,255,0.8); border-color: var(--color-primary); transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
		.light-mode .list-controls .control-btn { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); color: var(--color-text-muted); }
		.light-mode .list-controls .control-btn select { color: var(--color-text-muted); }
		.light-mode .list-controls .control-btn:hover { border-color: var(--color-primary); color: var(--color-text); }
		.light-mode .course-actions button:hover{ color:var(--color-text); }
		.light-mode .course-progress { background: rgba(0,0,0,0.06); }
		.light-mode .quick-add-btn { background-color: rgba(0,0,0,0.05); color: var(--color-text-muted); }
		.light-mode .quick-add-btn:hover { background-color: rgba(var(--rgb-primary), 0.1); border-color: var(--color-primary); color: var(--color-primary); }
		.light-mode .footer-link-text:hover { color: var(--color-text); }
		.light-mode .footer-icon-btn:hover { background-color: rgba(var(--rgb-primary), 0.1); }
		.light-mode .result-section { background: radial-gradient(circle,rgba(var(--rgb-status,var(--rgb-primary)),0.07) 0%,transparent 70%), var(--color-card); }
		.light-mode .predictive-text {background: rgba(var(--rgb-status, var(--rgb-primary)), 0.08);border-color: rgba(var(--rgb-status, var(--rgb-primary)), 0.15);}
		.light-mode .denial-message {background: rgba(var(--rgb-danger), 0.08);border-color: rgba(var(--rgb-danger), 0.15);}
		.light-mode .recommendation-message {box-shadow: 0 4px 20px -5px rgba(var(--rgb-status), 0.3);}
		.light-mode .recommendation-message.correct {background: rgba(var(--rgb-primary), 0.1);border-color: rgba(var(--rgb-primary), 0.2);}
        .light-mode .recommendation-message.warning {background: rgba(var(--rgb-warning), 0.1);border-color: rgba(var(--rgb-warning), 0.2);}
		.light-mode .swal2-popup { box-shadow: 0 10px 50px rgba(0,0,0,0.1) !important;}
		.light-mode .swal2-cancel { background: #f0f0f0 !important; color: var(--color-text) !important; }
		.light-mode .modal-overlay { background-color: rgba(0, 0, 0, 0.15); }
		.light-mode .modal-close-btn:hover { color: var(--color-text); }
		.light-mode .stepper-control button:disabled { color: var(--color-text-muted) !important; }
		.light-mode .data-management-zone { border-color: rgba(var(--rgb-warning), 0.3); background: rgba(var(--rgb-warning), 0.05); }
		.light-mode .mode-toggle { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); }

		@media (min-width: 768px) {
			.input-grid {
				grid-template-columns: 1fr 1fr;
				align-items: end;
				gap: 1.25rem 1.5rem;
			}
			.input-grid .input-group:first-child {
				grid-column: 1 / -1;
			}
			.result-section {
				flex-direction: row;
				align-items: center;
			}
			.result-details {
				text-align: right;
			}
			.detail-item {
				justify-content: flex-start;
				gap: 1rem;
			}
		}
		@media(max-width:600px){
			.app { padding: 1.5rem 1rem; }
			.card { padding: 1.25rem; }
			.title { font-size: 2.2rem; }
			.card-header { padding-bottom: 1rem; margin-bottom: 1rem; }
			.card-header h2 { font-size: 1.5rem; }
			.result-section { flex-direction: column; padding: 1rem; }
			.chart-container { width: 100px; height: 100px; }
			.chart-info span { font-size: 1.6rem; }
			.course-list-header { flex-direction: column; align-items: stretch; }
			.data-management-zone .settings-item {
				flex-direction: column;
				align-items: flex-start;
				gap: 1rem;
			}
			.data-management-zone-btn {
				align-self: flex-end;
			}
		}
	</style>
</head>
<body>
    <div class="cosmic-bg-container">
        <div class="nebula-glow"></div>
        <canvas id="starfield-canvas"></canvas>
    </div>

	<noscript>You need to enable JavaScript to run this app.</noscript>
	<div id="root"></div>

	<script type="text/babel">
		const { useState, useEffect, useMemo, useCallback, StrictMode, useRef } = React;
		const { createPortal } = ReactDOM;
		const ReactDOMServer = { renderToString: (component) => { const div = document.createElement('div'); ReactDOM.createRoot(div).render(component); return div.innerHTML; }};
		
		const SvgIcon = ({ d, viewBox = "0 0 24 24", ...props }) => (
			<svg stroke="currentColor" fill="currentColor" strokeWidth="0" viewBox={viewBox} height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" {...props}>
				<path d={d}></path>
			</svg>
		);

		const Icons = {
			TableChart: props => <SvgIcon d="M20 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 19H5v-5h3v5zm5 0h-3v-5h3v5zm5 0h-3v-5h3v5zm0-7H5V5h15v7z" {...props} />,
			IconClock: props => <SvgIcon d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" {...props} />,
            IconEquation: props => <SvgIcon d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4 14h-2v-2h2v2zm-4 0H9v-2h2v2zm2-3h-2v-2h2v2zm-2-2H9v-2h2v2zm4-1h-2v-2h2v2zm0-3h-2V9h2v2z" {...props} />,
            IconCalendar: props => <SvgIcon d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z" {...props} />,
			ChevronRight: props => <SvgIcon d="M9 18L15 12 9 6" {...props} />,
			ChevronLeft: props => <SvgIcon d="M15 18L9 12 15 6" {...props} />,
			Plus: props => <SvgIcon d="M12 5V19M5 12H19" {...props} />,
			Close: props => <SvgIcon d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" {...props} />,
			Edit2: props => <SvgIcon d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" {...props} />,
			Trash: props => <SvgIcon d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" {...props} />,
			Telegram: props => <SvgIcon d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 1.62 11.22c-.72-.24-.72-1.16 0-1.41l18.26-6.91c.63-.24 1.22.23 1.01.89L17.43 18.4c-.2 1.39-1.53 1.76-2.53.94l-4.26-3.51-2.86 2.72a.5.5 0 0 1-.88-.38v-4.48z" {...props} />,
			Save: props => <SvgIcon d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zM15 9H5V5h10v4z" {...props} />,
			Lightbulb: props => <SvgIcon d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z" {...props} />,
			Sort: props => <SvgIcon d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z" {...props} />,
			ClipboardList: props => <SvgIcon d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" {...props} />,
			WarningCircle: props => <SvgIcon d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" {...props} />,
			HelpCircle: props => <SvgIcon d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" {...props} />,
			Settings: props => <SvgIcon d="M19.14 12.94c.04-.3.06-.61.06-.94s-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.44.17-.48.41L9.22 5.25C8.63 5.49 8.1 5.81 7.6 6.19L5.21 5.23c-.22-.08-.47 0-.59.22L2.7 8.77c-.11.2-.06.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18-.14-.23-.41-.12-.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.38 2.44c.04.24.24.41.48.41h3.84c.24 0 .44-.17-.48.41l.38-2.44c.59-.24 1.12-.56 1.62-.94l2.39.96c.22.08.47.02.59-.22l1.92-3.32c.11-.2.06-.47-.12-.61l-2.03-1.58zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z" {...props} />,
			CheckCircle: props => <SvgIcon d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" {...props} />,
			Download: props => <SvgIcon d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z" {...props} />,
			ShieldCheck: props => <SvgIcon d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 15l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z" {...props} />,
		};

        const CONSTANTS = { 
			DENIAL_PERCENTAGE: 0.25, 
			MIN_WEEKS: 7, 
			MAX_WEEKS: 20,
			RECOMMENDED_WEEKS: 7,
			RECOMMENDED_SEMESTER_NAME: "465"
		};
		const PRESET_THEMES = {
			blue: '#5e9cff',
			purple: '#a777ff',
			green: '#00c853',
		};

		const SUBTITLES = [
            "راقب غيابك بأسلوب لم تره من قبل",
            "أداة بسيطة وقوية لمتابعة غيابك الدراسي",
            "احسب غيابك بدقة، وبلا تعقيد",
            "أداة ذكية وسلسة لمتابعة الغياب",
            "تابع غيابك، ولا تتركه للصدفة!",
            "سهولة لكل مستخدم، ودقة لكل معلومة",
            "أداة سهلة، سريعة، دقيقة"
        ];
		
		const DEFAULT_FORM_STATE = { name: "", lectureHours: 4, absenceHours: "" };

        const Toast = Swal.mixin({
            toast: true, position: 'bottom', showConfirmButton: false, timer: 3000, timerProgressBar: true,
            didOpen: (toast) => { toast.addEventListener('mouseenter', Swal.stopTimer); toast.addEventListener('mouseleave', Swal.resumeTimer); }
        });
		
		const useLocalStorage = (key, defaultValue) => {
			const [value, setValue] = useState(() => {
				try { const saved = localStorage.getItem(key); return saved ? JSON.parse(saved) : defaultValue; }
				catch (error) { return defaultValue; }
			});
			useEffect(() => { localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
			return [value, setValue];
		};

		const useAnimatedNumber = (target, duration = 500) => {
			const [currentNumber, setCurrentNumber] = useState(target);
			const frameRef = useRef();
			const startNumberRef = useRef(target);
			const startTimeRef = useRef();

			useEffect(() => {
				const startNumber = startNumberRef.current;
				startTimeRef.current = performance.now();
				
				const animate = (currentTime) => {
					const elapsedTime = currentTime - startTimeRef.current;
					const progress = Math.min(elapsedTime / duration, 1);
					const easeOutProgress = 1 - Math.pow(1 - progress, 3);
					
					const newNumber = startNumber + (target - startNumber) * easeOutProgress;
					setCurrentNumber(newNumber);

					if (progress < 1) {
						frameRef.current = requestAnimationFrame(animate);
					} else {
						startNumberRef.current = target;
					}
				};

				frameRef.current = requestAnimationFrame(animate);

				return () => cancelAnimationFrame(frameRef.current);
			}, [target, duration]);

			return currentNumber;
		};

        function hexToRgb(hex) {
            let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;
        }

        function adjustColorBrightness(hex, percent) {
            let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
            const p = percent / 100;
            r = Math.min(255, Math.max(0, Math.round(r * (1 + p))));
            g = Math.min(255, Math.max(0, Math.round(g * (1 + p))));
            b = Math.min(255, Math.max(0, Math.round(b * (1 + p))));
            return `#${(r).toString(16).padStart(2, '0')}${(g).toString(16).padStart(2, '0')}${(b).toString(16).padStart(2, '0')}`;
        }

		const hexToHue = H => {
			if (!H) return 217;
			let r=0,g=0,b=0;
			if(H.length==7){r="0x"+H[1]+H[2];g="0x"+H[3]+H[4];b="0x"+H[5]+H[6];}
			r/=255;g/=255;b/=255;
			let cmin=Math.min(r,g,b),cmax=Math.max(r,g,b),delta=cmax-cmin,h=0;
			if(delta==0)h=0; else if(cmax==r)h=((g-b)/delta)%6; else if(cmax==g)h=(b-r)/delta+2; else h=(r-g)/delta+4;
			h=Math.round(h*60); if(h<0)h+=360;
			return h;
		};

		const formatRemainingHoursText = (hours) => {
			if (hours <= 0) return "0 ساعات";
			const roundedHours = Math.round(hours);
			if (roundedHours === 1) return "ساعة واحدة";
			if (roundedHours === 2) return "ساعتين";
			if (roundedHours >= 3 && roundedHours <= 10) return `${roundedHours} ساعات`;
			return `${roundedHours} ساعة`;
		};
		
		const formatLectureHoursText = (hours) => {
			const roundedHours = Math.round(hours);
			if (roundedHours === 1) return "ساعة";
			if (roundedHours === 2) return "ساعتين";
			if (roundedHours >= 3 && roundedHours <= 10) return `${roundedHours} ساعات`;
			return `${roundedHours} ساعة`;
		};

		const formatWeeksText = (weeks) => {
			if (weeks === 1) return "أسبوع واحد";
			if (weeks === 2) return "أسبوعين";
			if (weeks >= 3 && weeks <= 10) return `${weeks} أسابيع`;
			return `${weeks} أسبوعًا`;
		};

		function formatArabicPlural(number, forms) {
			if (number === 1) return forms.singular;
			if (number === 2) return forms.dual;
			if (number >= 3 && number <= 10) return `${number} ${forms.paucal}`;
			return `${number} ${forms.plural}`;
		}
		
		const formatHoursPlural = (number) => {
			return formatArabicPlural(number, { singular: 'ساعة', dual: 'ساعتين', paucal: 'ساعات', plural: 'ساعة' });
		}

		function formatRelativeTime(timestamp) {
			const now = new Date(), past = new Date(timestamp), diff = (now - past) / 1000;
			if (diff < 10) return 'الآن';
			if (diff < 60) return `قبل ${formatArabicPlural(Math.round(diff), { singular: 'ثانية', dual: 'ثانيتين', paucal: 'ثوانٍ', plural: 'ثانية' })}`;
			const mins = Math.round(diff / 60);
			if (mins < 60) return `قبل ${formatArabicPlural(mins, { singular: 'دقيقة', dual: 'دقيقتين', paucal: 'دقائق', plural: 'دقيقة' })}`;
			const hours = Math.round(diff / 3600);
			if (hours < 24) return `قبل ${formatArabicPlural(hours, { singular: 'ساعة', dual: 'ساعتين', paucal: 'ساعات', plural: 'ساعة' })}`;
			const days = Math.round(diff / 86400);
			if (days === 1) return "بالأمس";
			return `قبل ${formatArabicPlural(days, { singular: 'يوم', dual: 'يومين', paucal: 'أيام', plural: 'يومًا' })}`;
		}

		function getCourseStatus(course, semesterWeeks) {
			const absenceNum = Number(course.absenceHours) || 0;
            const total = semesterWeeks * course.lectureHours;
            const allowed = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE);
            const denial = allowed + 1;
            const remaining = denial - absenceNum;
            const isDenied = absenceNum >= denial;
            if (isDenied) return { name: 'danger', remaining, isDenied };
            if (remaining <= 2 && !isDenied) return { name: 'warning', remaining, isDenied };
            return { name: 'safe', remaining, isDenied };
        }
		
		const AnimatedNumber = ({ value, formatter = (n) => n.toFixed(1) }) => {
			const animatedValue = useAnimatedNumber(value);
			return <>{formatter(animatedValue)}</>;
		};

		function DonutChart({ percentage, status }) {
			const animatedPercentage = useAnimatedNumber(percentage);
			const circumference = 2 * Math.PI * 45;
			const offset = circumference - (animatedPercentage / 100) * circumference;
			return (
				<div className="chart-container">
					<svg className="donut-chart" viewBox="0 0 100 100"><circle className="donut-chart-bg" cx="50" cy="50" r="45" /><circle className={`donut-chart-fg ${status}`} cx="50" cy="50" r="45" strokeDasharray={circumference} strokeDashoffset={Math.max(0, offset)} /></svg>
					<div className="chart-info">
						<span><AnimatedNumber value={percentage} />%</span>
						<p>نسبة الغياب</p>
					</div>
				</div>
			);
		};

		const ActionPicker = ({ options, value, onChange }) => {
			const [isOpen, setIsOpen] = useState(false);
			const wrapperRef = useRef(null);
			const selectedOption = options.find(opt => opt.value === value);

			const handleOptionClick = (newValue) => {
				onChange(newValue);
				setIsOpen(false);
			};

			useEffect(() => {
				const handleClickOutside = (event) => {
					if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {
						setIsOpen(false);
					}
				};
				document.addEventListener("mousedown", handleClickOutside);
				return () => document.removeEventListener("mousedown", handleClickOutside);
			}, [wrapperRef]);


			return (
				<div className="action-picker-wrapper" ref={wrapperRef}>
					<button 
						type="button" 
						className="action-picker-display"
						onClick={() => setIsOpen(!isOpen)}
					>
						{selectedOption ? selectedOption.label : '...'}
					</button>

					{isOpen && (
						<div className="action-picker-panel">
							{options.map(option => (
								<button
									type="button"
									key={option.value}
									className={`action-picker-option ${value === option.value ? 'selected' : ''}`}
									onClick={() => handleOptionClick(option.value)}
								>
									{option.label}
								</button>
							))}
						</div>
					)}
				</div>
			);
		};

		const CourseItem = ({ course, onSelect, onDelete, onQuickAdd, style, semesterWeeks, lastUpdatedId }) => {
			const [isUpdated, setIsUpdated] = useState(false);
			useEffect(() => { if (lastUpdatedId === course.id) { setIsUpdated(true); const timer = setTimeout(() => setIsUpdated(false), 1500); return () => clearTimeout(timer); } }, [lastUpdatedId, course.id]);
			
			const { name: status, remaining } = getCourseStatus(course, semesterWeeks);
			const denial = Math.floor((semesterWeeks * course.lectureHours) * CONSTANTS.DENIAL_PERCENTAGE) + 1;
			
			return (
				<div className={`course-item ${status} ${isUpdated ? "updated" : ""}`} style={style}>
					<div className="course-top-row">
						<div className="course-info">
							<h3>{course.name}</h3>
							<p>ساعات الغياب: {course.absenceHours} | المتبقي للحرمان: <AnimatedNumber value={remaining} formatter={formatRemainingHoursText} /></p>
						</div>
						<div className="course-actions">
							<button onClick={() => onSelect(course)} title="تعديل"><Icons.Edit2 /></button>
							<button onClick={() => onDelete(course.id)} title="حذف"><Icons.Trash /></button>
						</div>
					</div>
					<div className="course-progress">
						<div className="course-progress-bar" style={{ width: `${Math.min(100, (Number(course.absenceHours) / denial) * 100)}%` }}></div>
					</div>
					<div className="course-meta">
						<div className="meta-info">
							<span>{formatRelativeTime(course.lastUpdated)}</span>
						</div>
						<div className="quick-add-controls">
							<button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 1)}>+1</button>
							<button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 2)}>+2</button>
							<button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 3)}>+3</button>
						</div>
					</div>
				</div>
			);
		};

		function CourseList({ courses, onSelect, onDelete, onQuickAdd, sortOrder, onSortChange, semesterWeeks, lastUpdatedId }) {
			return (
				<div id="course-list-section" className="card" style={{ animationDelay: '.2s' }}>
					<div className="card-header">
						<h2><Icons.ClipboardList /> قائمة المقررات</h2>
						<div className="list-controls">
							<div className="control-btn">
								<Icons.Sort className="sort-icon" />
								<select value={sortOrder} onChange={e => onSortChange(e.target.value)} title="فرز المقررات">
                                    <option value="urgency">الأكثر حرجًا</option>
                                    <option value="remaining">الأقل تبقيًا</option>
                                    <option value="recent">الأحدث تحديثًا</option>
                                    <option value="alpha">أبجدي</option>
                                </select>
							</div>
						</div>
					</div>
					{courses.length === 0 ? 
						<div className="empty-list-message">
							<Icons.ClipboardList style={{ fontSize: '3.5rem', opacity: 0.5, color: 'var(--color-primary)' }}/>
							<h3>قائمتك فارغة</h3>
							<p>ابدأ بإضافة مقرر جديد من الأعلى لتتبع غيابك.</p>
						</div> : 
						<div className="course-list">{courses.map((course, index) => <CourseItem key={course.id} course={course} onSelect={onSelect} onDelete={onDelete} onQuickAdd={onQuickAdd} semesterWeeks={semesterWeeks} lastUpdatedId={lastUpdatedId} style={{ animationDelay: `${index * 100}ms` }} />)}</div>
					}
				</div>
			);
		}
		
		const useDoubleClickOnElementToClose = (elementRef, onClose) => {
			useEffect(() => {
				const element = elementRef.current;
				if (!element) return;
				const handleDoubleClick = (e) => {
					if (!e.target.closest('button, input, select, a, .theme-dot, .color-picker-label, .action-picker-wrapper, .stepper-control')) {
						onClose();
					}
				};
				element.addEventListener('dblclick', handleDoubleClick);
				return () => element.removeEventListener('dblclick', handleDoubleClick);
			}, [elementRef, onClose]);
		};

		function SettingsModal({ isOpen, onClose, children }) {
			const modalContentRef = useRef(null);
			useDoubleClickOnElementToClose(modalContentRef, onClose);
			
			useEffect(() => {
				if (isOpen) {
					document.body.classList.add('modal-open');
				} else {
					document.body.classList.remove('modal-open');
				}
				return () => document.body.classList.remove('modal-open');
			}, [isOpen]);
			
			if (!isOpen) return null;

			const handleOverlayClick = (e) => {
				if (e.target === e.currentTarget) {
					onClose();
				}
			};

			return createPortal(
				<div className="modal-overlay" onClick={handleOverlayClick}>
					<div className="modal-content" ref={modalContentRef}>
						<button onClick={onClose} className="modal-close-btn" title="إغلاق"><Icons.Close /></button>
						{children}
					</div>
				</div>,
				document.body
			);
		}

		function AbsenceCalculator({ onSave, isEditing, onClear, courseData, onCourseDataChange, courses, semesterWeeks }) {
			const { name, lectureHours, absenceHours } = courseData;

			const result = useMemo(() => {
				const absenceNum = parseInt(absenceHours, 10) || 0;
				const total = semesterWeeks * lectureHours;
				const allowed = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE);
				const denial = allowed + 1;
				const percentage = total > 0 ? (absenceNum / total) * 100 : 0;
				const remaining = denial - absenceNum;
				const { name: status, isDenied } = getCourseStatus({ absenceHours: absenceNum, lectureHours }, semesterWeeks);
				
				let predictiveText = "";
				if (!isDenied) {
					predictiveText = `أنت على بعد ${formatRemainingHoursText(remaining)} من الحرمان.`;
				}
				
				return { percentage, status, predictiveText, allowed, denial, isDenied };
			}, [lectureHours, absenceHours, semesterWeeks]);

			const handleSubmit = (e) => {
				e.preventDefault();
				if (!name && courses.length > 0 && !isEditing) {
                    Toast.fire({ icon: 'warning', title: 'الرجاء إدخال اسم المقرر' });
                    return;
                }
                const courseName = name || 'حساب سريع';
				
				const existingCourse = courses.find(c => c.name.trim().toLowerCase() === courseName.trim().toLowerCase());
				if (existingCourse && (!isEditing || courseData.id !== existingCourse.id)) {
					Swal.fire({
						icon: 'warning', title: 'المقرر موجود بالفعل', text: `هل تريد تعديل بيانات مقرر ${existingCourse.name}؟`,
						showCancelButton: true, confirmButtonText: 'نعم، قم بالتعديل', cancelButtonText: 'إلغاء',
						scrollbarPadding: false,
						customClass: { popup: 'swal-popup-animation-in' },
						showClass: { popup: '' }, hideClass: { popup: 'swal-popup-animation-out' }
					}).then((result) => { if (result.isConfirmed) onClear(existingCourse); });
					return;
				}

				onSave({
					...courseData,
					name: courseName,
					absenceHours: parseInt(absenceHours, 10) || 0,
				});

                if (name && name !== 'حساب سريع') {
                    Toast.fire({ icon: 'success', title: isEditing ? 'تم تحديث المقرر بنجاح' : 'تمت إضافة المقرر بنجاح' });
                }
			};

			const changeAbsence = (change) => {
				const currentAbsence = parseInt(absenceHours, 10) || 0;
				onCourseDataChange({ absenceHours: String(Math.max(0, currentAbsence + change)) });
			};
			
			const showExplanation = () => {
				const explanationHtml = `
				<div class="swal-explanation-content">
					<h4><span style="font-size: 1.3em; color: var(--color-primary);">${ReactDOMServer.renderToString(<Icons.IconClock/>)}</span> أولاً: الساعات الأسبوعية</h4>
					<p>الغياب يُحسب على <strong>ساعات الحضور الأسبوعية</strong> للمقرر، وليس على ساعاته المعتمدة في المعدل.</p>
					<div class="swal-example-box"><strong>مثال:</strong> لمقرر محاضرتين بالأسبوع، وكل محاضرة مدتها ساعتان، بالتالي ساعات الحضور الأسبوعية = <strong>4 ساعات</strong>.</div>
					<hr/>
					<h4><span style="font-size: 1.3em; color: var(--color-danger-red);">${ReactDOMServer.renderToString(<Icons.IconEquation/>)}</span> ثانياً: معادلة الحرمان</h4>
					<p>يتم الحرمان عند تجاوز نسبة الغياب <strong style="color: var(--color-danger-red);">25%</strong> من مجموع الساعات الدراسية الفعلية للمقرر.</p>
					<hr/>
					<h4><span style="font-size: 1.3em; color: var(--color-warning-gold);">${ReactDOMServer.renderToString(<Icons.IconCalendar/>)}</span> ثالثاً: تحديد عدد الأسابيع</h4>
					<p>يتم حساب الغياب على أساس عدد الأسابيع الفعلية للدراسة، ويمكنك ضبط هذا العدد من الإعدادات ⚙️.</p>
					<p class="swal-tip">✨ نصيحة: لإغلاق هذه النافذة بسرعة، المسها مرتين!</p>
				</div>`;

				Swal.fire({
					title: 'كيف يتم حساب الغياب؟',
                    html: explanationHtml,
                    showCloseButton: true,
                    showConfirmButton: false,
					scrollbarPadding: false,
                    customClass: {
						popup: 'swal-popup-animation-in swal-popup-explanation-compact'
					},
                    showClass: { popup: '' },
                    hideClass: { popup: 'swal-popup-animation-out' },
					didOpen: (popup) => {
						popup.addEventListener('dblclick', (e) => {
							if (!e.target.closest('button, input, select, a, strong')) {
								Swal.close();
							}
						});
					}
				});
			};
			
			const showAbsenceTable = () => {
				let tableRowsHtml = '';
				for (let i = 1; i <= 12; i++) {
					const total = semesterWeeks * i;
					const allowed = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE);
					const denial = allowed + 1;
					tableRowsHtml += `
						<tr>
							<td class="col-hours">${formatHoursPlural(i)}</td>
							<td class="col-allowed">${formatHoursPlural(allowed)}</td>
							<td class="col-denial">${formatHoursPlural(denial)}</td>
						</tr>
					`;
				}

				const tableHtml = `
					<p style="text-align:right; font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 1rem;">
						الجدول التالي محسوب بناءً على <span class="highlight-weeks">${formatWeeksText(semesterWeeks)}</span> دراسية. يمكنك تغييرها من الإعدادات ⚙️.
					</p>
					<div class="swal-table-container">
						<table class="swal-info-table">
							<thead>
								<tr>
									<th>الساعات الأسبوعية</th>
									<th>الغياب المسموح</th>
									<th>يبدأ الحرمان من</th>
								</tr>
							</thead>
							<tbody>
								${tableRowsHtml}
							</tbody>
						</table>
					</div>
					<p style="text-align: center; font-size: 0.9rem; color: var(--color-primary); font-weight: 600; margin-top: 1.25rem; margin-bottom: 0;">
						✨ نصيحة: لإغلاق النافذة، المسها مرتين!
					</p>
				`;
				
				Swal.fire({
					title: 'لائحة الغياب المرجعية',
					html: tableHtml,
					showCloseButton: true,
					showConfirmButton: false,
					scrollbarPadding: false,
					customClass: { 
						popup: 'swal-popup-animation-in swal-popup-table-compact'
					},
					showClass: { popup: '' },
					hideClass: { popup: 'swal-popup-animation-out' },
					didOpen: (popup) => {
						popup.addEventListener('dblclick', (e) => {
							if (!e.target.closest('button, input, select, a, strong, table')) {
								Swal.close();
							}
						});
					}
				});
			};

			const showExcusedAbsenceInfo = () => {
				const exampleHours = 2;
				const unexcusedAllowed = Math.floor(exampleHours * semesterWeeks * 0.25);
				const excusedAllowed = Math.floor(exampleHours * semesterWeeks * 0.25);

				const explanationHtml = `
				<div class="swal-explanation-content">
					<h4><span style="font-size: 1.3em; color: var(--color-danger-red);">${ReactDOMServer.renderToString(<Icons.WarningCircle/>)}</span> الغياب بدون عذر</h4>
					<p>يُسمح لك بالغياب بدون عذر مقبول بنسبة لا تتجاوز 25% من الساعات الدراسية للمقرر.</p>
					<hr/>
					<h4><span style="font-size: 1.3em; color: var(--color-primary);">${ReactDOMServer.renderToString(<Icons.ShieldCheck/>)}</span> الغياب بعذر</h4>
					<p>يُسمح لك بالغياب بعذر مقبول بنسبة 25% إضافية، بحيث لا يتجاوز مجموع غيابك 50%.</p>
					<hr/>
					<h4><span style="font-size: 1.3em; color: var(--color-warning-gold);">${ReactDOMServer.renderToString(<Icons.Lightbulb/>)}</span> مثال توضيحي</h4>
					<div class="swal-example-box">
						<p style="margin-bottom: 0.5rem;">لمقرر <strong>بساعتين أسبوعيًا</strong> (<span class="highlight-weeks">على مدى ${formatWeeksText(semesterWeeks)}</span>):</p>
						<ul style="padding-right: 20px; margin-top: 0.5rem; margin-bottom: 0;">
							<li style="margin-bottom: 0.5rem;"><strong>الغياب بدون عذر (25%):</strong> ${formatHoursPlural(unexcusedAllowed)}</li>
							<li><strong>الغياب بعذر (25%):</strong> ${formatHoursPlural(excusedAllowed)}</li>
						</ul>
					</div>
					<hr/>
					<h4><span style="font-size: 1.3em; color: var(--color-warning-gold);">${ReactDOMServer.renderToString(<Icons.WarningCircle/>)}</span> ملاحظة هامة </h4>
					<p>ساعات الغياب بنوعيها منفصلة. لكن، يجب ألا يتجاوز <strong>مجموع الغياب (بعذر وبدونه) 50%</strong> وإلا يعتبر الطالب محرومًا من المقرر.</p>
					<div style="text-align: center; margin-top: 1.5rem;">
						<a href="https://t.me/Qassim_R/349" target="_blank" rel="noopener noreferrer" style="color: var(--color-primary); font-weight: 600; text-decoration: none; padding: 4px 8px; border-bottom: 1px solid;">
							طريقة تقديم أعذار الغياب
						</a>
					</div>
					<p class="swal-tip">✨ نصيحة: لإغلاق هذه النافذة بسرعة، المسها مرتين!</p>
				</div>`;

				Swal.fire({
					title: 'الغياب بعذر وبدون عذر',
					html: explanationHtml,
					showCloseButton: true,
					showConfirmButton: false,
					scrollbarPadding: false,
					customClass: {
						popup: 'swal-popup-animation-in swal-popup-explanation-compact'
					},
					showClass: { popup: '' },
					hideClass: { popup: 'swal-popup-animation-out' },
					didOpen: (popup) => {
						popup.addEventListener('dblclick', (e) => {
							if (!e.target.closest('button, input, select, a, strong')) {
								Swal.close();
							}
						});
					}
				});
			};

			const lectureOptions = useMemo(() => 
				[...Array(12).keys()].map(i => ({ value: i + 1, label: formatLectureHoursText(i + 1) })),
			[]);

			return (
				<form id="main-calculator-card" className={`card ${result?.status}`} onSubmit={handleSubmit}>
					<div className="card-header">
                        <h2>{isEditing ? <><Icons.Edit2 /> تعديل المقرر</> : <><Icons.Plus /> إضافة مقرر جديد</>}</h2>
						<div className="card-header-controls">
							<button type="button" className="header-icon-btn" onClick={showExcusedAbsenceInfo} title="معلومات الغياب بعذر"><Icons.ShieldCheck /></button>
							<button type="button" className="header-icon-btn" onClick={showAbsenceTable} title="عرض لائحة الغياب المرجعية"><Icons.TableChart /></button>
							<button type="button" className="header-icon-btn" onClick={showExplanation} title="شرح طريقة الحساب"><Icons.HelpCircle /></button>
							{isEditing && <button type="button" className="header-icon-btn clear-button" onClick={() => onClear(null)} title="إلغاء التعديل"><Icons.Plus /></button>}
						</div>
                    </div>
					<div className="input-grid">
						<div className="input-group" style={{gridColumn: '1 / -1'}}>
							<label htmlFor="course-name-input">اسم المقرر</label>
							<input id="course-name-input" type="text" value={name} onChange={e => onCourseDataChange({ name: e.target.value })} placeholder="مثال: فيزياء 101" />
							{!isEditing && <p className="input-hint">للحساب السريع، اترك اسم المقرر فارغًا.</p>}
						</div>
						<div className="input-group">
							<div className="label-with-icon-container">
								<label>الساعات الأسبوعية</label>
								<div className="info-tooltip-wrapper">
									<Icons.Lightbulb />
									<span className="info-tooltip">الغياب يُحسب على ساعات الحضور الأسبوعية للمقرر، وليس على ساعاته المعتمدة في المعدل.<br/><br/>فمثلًا: لمقرر محاضرتين بالأسبوع، وكل محاضرة مدتها ساعتان، بالتالي ساعات الحضور الأسبوعية<br/>= 4 ساعات.</span>
								</div>
							</div>
							<ActionPicker
								options={lectureOptions}
								value={lectureHours}
								onChange={(val) => onCourseDataChange({ lectureHours: val })}
							/>
						</div>
						<div className="input-group">
							<label>ساعات الغياب الحالية</label>
							<div className="absence-control">
								<button type="button" onClick={() => changeAbsence(1)}><Icons.ChevronRight /></button>
								<input type="number" value={absenceHours} onChange={e => onCourseDataChange({ absenceHours: e.target.value })} placeholder="0" min="0" />
								<button type="button" onClick={() => changeAbsence(-1)}><Icons.ChevronLeft /></button>
							</div>
						</div>
					</div>
					
					{result && (courseData.absenceHours !== "" || isEditing) && (<>
						<div className="divider"></div>
						<div className="result-section">
							<DonutChart percentage={result.percentage} status={result.status} />
							<div className="result-details">
								<div className="detail-item"><span>الغياب المسموح</span><strong>{formatRemainingHoursText(result.allowed)}</strong></div>
								<div className="detail-item"><span>الحرمان</span><strong>{formatRemainingHoursText(result.denial)}</strong></div>
								{result.isDenied ? (
									<div className="denial-message">
										<Icons.WarningCircle className="denial-icon" />
										<div className="denial-text-content">
											<p className="denial-title">حرمان</p>
											<span className="denial-subtitle">لقد تجاوزت الحد الأقصى للغياب.</span>
										</div>
									</div>
								) : (<div className="predictive-text">{result.predictiveText}</div>)}
							</div>
						</div>
					</>)}
					<button type="submit" className="save-button">{isEditing ? <><Icons.Save /> تحديث المقرر</> : <><Icons.Save /> إضافة مقرر</>}</button>
				</form>
			);
		}
		
		function App() {
			const [courses, setCourses] = useLocalStorage("courses", []);
			const [selectedCourse, setSelectedCourse] = useState(null);
			const [formData, setFormData] = useState(DEFAULT_FORM_STATE);

			const [sortOrder, setSortOrder] = useState('urgency');
			const [theme, setTheme] = useLocalStorage('theme', PRESET_THEMES.blue);
			const [semesterWeeks, setSemesterWeeks] = useLocalStorage('semesterWeeks', CONSTANTS.RECOMMENDED_WEEKS);
			const [lastUpdatedId, setLastUpdatedId] = useState(null);
			const [isSettingsOpen, setIsSettingsOpen] = useState(false);
			const [subtitle, setSubtitle] = useState(SUBTITLES[0]);
			const [colorMode, setColorMode] = useLocalStorage('colorMode', 'dark');
			const [installPrompt, setInstallPrompt] = useState(null);

			useEffect(() => {
				if (selectedCourse) {
					setFormData(selectedCourse);
				} else {
					setFormData(DEFAULT_FORM_STATE);
				}
			}, [selectedCourse]);

			const handleFormChange = (newValues) => {
				setFormData(prevData => ({ ...prevData, ...newValues }));
			};

			useEffect(() => {
                const primaryColor = theme;
                const darkColor = adjustColorBrightness(primaryColor, -20);
                const rgbColor = hexToRgb(primaryColor);
				const primaryHue = hexToHue(primaryColor);
    			const secondaryHue = (primaryHue + 40) % 360;

                document.documentElement.style.setProperty('--color-primary', primaryColor);
                document.documentElement.style.setProperty('--color-primary-dark', darkColor);
                if (rgbColor) { document.documentElement.style.setProperty('--rgb-primary', rgbColor); }
				document.documentElement.style.setProperty('--primary-hue', String(primaryHue));
                document.documentElement.style.setProperty('--secondary-hue', String(secondaryHue));
			}, [theme]);
			
			useEffect(() => {
				document.body.className = colorMode === 'light' ? 'light-mode' : '';
				const themeColorMeta = document.querySelector('meta[name="theme-color"]');
				if (themeColorMeta) { themeColorMeta.setAttribute('content', colorMode === 'light' ? '#f9f9f9' : '#0a0a0a'); }
			}, [colorMode]);
			
			useEffect(() => {
				const handler = e => { e.preventDefault(); setInstallPrompt(e); };
				window.addEventListener('beforeinstallprompt', handler);
				return () => window.removeEventListener('beforeinstallprompt', handler);
			}, []);
			
			// This effect runs once on mount to force update semester weeks for all users.
			useEffect(() => {
				setSemesterWeeks(CONSTANTS.RECOMMENDED_WEEKS);
			}, []);

			useEffect(() => {
				const randomIndex = Math.floor(Math.random() * SUBTITLES.length);
            	setSubtitle(SUBTITLES[randomIndex]);
				if ('serviceWorker' in navigator) {
					const swCode = `const CACHE_NAME = 'absence-calculator-cache-v60'; self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.add('.')))); self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));`;
					try { const blob = new Blob([swCode], { type: 'application/javascript' }); navigator.serviceWorker.register(URL.createObjectURL(blob)); } 
                    catch(e) { console.error("Could not register service worker.", e); }
				}
			}, []);

			const handleInstallClick = useCallback(async () => {
				if (!installPrompt) return;
				const result = await installPrompt.prompt();
				if (result.outcome === 'accepted') { Toast.fire({ icon: 'success', title: 'تم تثبيت التطبيق بنجاح!' }); }
				setInstallPrompt(null);
			}, [installPrompt]);

			const handleAddOrUpdate = (courseDataFromForm) => {
				const isNewUnnamed = !courseDataFromForm.name || courseDataFromForm.name === 'حساب سريع';
				if (isNewUnnamed && !selectedCourse) {
					setSelectedCourse(null);
					setFormData(DEFAULT_FORM_STATE);
					return;
				}
				
				const index = courses.findIndex(c => c.id === courseDataFromForm.id);
				const updatedCourses = [...courses];
				const courseToSave = {
					...courseDataFromForm,
					id: courseDataFromForm.id || Date.now(),
					lastUpdated: Date.now()
				};

				if (index > -1) { 
					updatedCourses[index] = courseToSave; 
				} else {
					updatedCourses.push(courseToSave);
				}
				setCourses(updatedCourses);
				setLastUpdatedId(courseToSave.id);
				setSelectedCourse(null);
			};

            const handleQuickAdd = useCallback((id, amount) => {
                let updatedCourse = null;
                const updatedCourses = courses.map(c => {
                    if (c.id === id) {
                        const currentAbsence = Number(c.absenceHours) || 0;
                        updatedCourse = { ...c, absenceHours: currentAbsence + amount, lastUpdated: Date.now() };
                        return updatedCourse;
                    }
                    return c;
                });

                setCourses(updatedCourses);
                setLastUpdatedId(id);

                if (selectedCourse && selectedCourse.id === id && updatedCourse) {
                    setSelectedCourse(updatedCourse);
					setFormData(updatedCourse);
                }

                if (!updatedCourse) return;
                const { name: status, remaining, isDenied } = getCourseStatus(updatedCourse, semesterWeeks);
                let toastOptions = { icon: 'success', title: `تم تحديث غياب مقرر ${updatedCourse.name} بنجاح` };
                if (isDenied) {
                    toastOptions = { icon: 'error', title: `لقد وصلت إلى الحرمان في مقرر ${updatedCourse.name}!` };
                } else if (status === 'warning') {
                    const remainingText = formatRemainingHoursText(remaining);
                    toastOptions = { icon: 'warning', title: `تحذير: غياب ${remainingText} أخرى سيؤدي للحرمان من مقرر ${updatedCourse.name}` };
                }
                Toast.fire(toastOptions);
            }, [courses, setCourses, semesterWeeks, selectedCourse]);

			const handleDelete = (id) => {
				Swal.fire({
					title: 'هل أنت متأكد؟', text: "لن تتمكن من استرجاع هذا المقرر!", icon: 'warning', showCancelButton: true, 
                    confirmButtonColor: 'var(--color-primary)', cancelButtonColor: 'var(--color-danger-red)',
					confirmButtonText: 'نعم، احذفه!', cancelButtonText: 'إلغاء',
					scrollbarPadding: false,
					customClass: { popup: 'swal-popup-animation-in' },
					showClass: { popup: '' }, hideClass: { popup: 'swal-popup-animation-out' },
				}).then((result) => {
					if (result.isConfirmed) {
						setCourses(courses.filter(c => c.id !== id)); 
						if (selectedCourse && selectedCourse.id === id) {
							setSelectedCourse(null);
						}
                        Toast.fire({ icon: 'success', title: 'تم حذف المقرر' });
					}
				})
			};

            const handleResetAll = () => {
				setIsSettingsOpen(false);
				setTimeout(() => {
					Swal.fire({
						title: 'هل أنت متأكد من مسح البيانات؟', text: "سيتم حذف جميع المقررات المحفوظة بشكل نهائي للبدء من جديد.", icon: 'warning',
						showCancelButton: true, confirmButtonColor: 'var(--color-danger-red)', cancelButtonColor: 'var(--color-border)',
						confirmButtonText: 'نعم، متأكد!', cancelButtonText: 'إلغاء',
						scrollbarPadding: false,
						customClass: { popup: 'swal-popup-animation-in' },
						showClass: { popup: '' }, hideClass: { popup: 'swal-popup-animation-out' },
					}).then((result) => {
						if (result.isConfirmed) {
							setCourses([]); 
							setSelectedCourse(null);
							Toast.fire({ icon: 'success', title: 'تم مسح جميع البيانات بنجاح' });
						}
					})
				}, 300);
            };

			const handleSelect = (course) => { 
				setSelectedCourse(course);
				window.scrollTo({ top: 0, behavior: "smooth" }); 
			};
			
			const handleClear = (courseToSelect = null) => { 
				setSelectedCourse(courseToSelect);
				if(courseToSelect) {
					window.scrollTo({ top: 0, behavior: "smooth" });
				}
			};
			
			const handleScrollToList = () => {
                const listElement = document.getElementById('course-list-section');
                if (listElement) { listElement.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
            };

			const sortedCourses = useMemo(() => {
				return [...courses].filter(c => c.name !== 'حساب سريع').sort((a, b) => {
                    const statusA = getCourseStatus(a, semesterWeeks);
                    const statusB = getCourseStatus(b, semesterWeeks);
                    switch (sortOrder) {
                        case 'recent': return b.lastUpdated - a.lastUpdated;
                        case 'alpha': return a.name.localeCompare(b.name, 'ar');
                        case 'remaining': return statusA.remaining - statusB.remaining;
                        case 'urgency': default:
                            const totalA = semesterWeeks * a.lectureHours, totalB = semesterWeeks * b.lectureHours;
							const percentageA = totalA > 0 ? (Number(a.absenceHours) / totalA) : 0;
                            const percentageB = totalB > 0 ? (Number(b.absenceHours) / totalB) : 0;
                            return percentageB - percentageA;
                    }
                });
			}, [courses, sortOrder, semesterWeeks]);
			
			const coursesForDisplay = useMemo(() => {
				if (!selectedCourse) return sortedCourses;
				return sortedCourses.map(course => 
					course.id === selectedCourse.id ? { ...course, ...formData } : course
				);
			}, [sortedCourses, selectedCourse, formData]);

            const isCustomTheme = !Object.values(PRESET_THEMES).includes(theme);
			const visibleCourses = coursesForDisplay.filter(c => c.name && c.name !== 'حساب سريع');
			
			const weekOptions = useMemo(() => 
				[...Array(CONSTANTS.MAX_WEEKS - CONSTANTS.MIN_WEEKS + 1).keys()].map(i => {
					const weekCount = CONSTANTS.MIN_WEEKS + i;
					return { value: weekCount, label: formatWeeksText(weekCount) };
				}),
			[]);

			return (
				<div className="app">
					<div className="container">
						<header className="header">
							<h1 className="title">حاسبة الغياب</h1>
							<p className="subtitle">{subtitle}</p>
						</header>

						{courses.filter(c => c.name && c.name !== 'حساب سريع').length > 0 && (
							<button className="view-list-btn" onClick={handleScrollToList}>
								<Icons.ClipboardList />
								<span>عرض قائمة المقررات</span>
							</button>
						)}

						<AbsenceCalculator 
							key={selectedCourse ? selectedCourse.id : "new"}
							onSave={handleAddOrUpdate} 
							isEditing={!!selectedCourse}
							onClear={handleClear} 
							courses={courses}
                            semesterWeeks={semesterWeeks}
							courseData={formData}
							onCourseDataChange={handleFormChange}
						/>
						
						{visibleCourses.length > 0 && <CourseList 
							courses={coursesForDisplay} 
							onSelect={handleSelect} 
							onDelete={handleDelete} 
							onQuickAdd={handleQuickAdd} 
							sortOrder={sortOrder} 
							onSortChange={setSortOrder} 
							semesterWeeks={semesterWeeks} 
							lastUpdatedId={lastUpdatedId} 
						/>}
						
						<SettingsModal isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)}>
							<h2 className="modal-header">الإعدادات</h2>
							<div className="settings-content">
								<div className="settings-section">
									<h3 className="settings-section-title">إعدادات الفصل</h3>
									<div className="settings-item">
										<h4>عدد أسابيع الفصل</h4>
										<div style={{ width: '130px' }}>
											<ActionPicker options={weekOptions} value={semesterWeeks} onChange={setSemesterWeeks} />
										</div>
									</div>
									{semesterWeeks === CONSTANTS.RECOMMENDED_WEEKS ? (
										<div className="recommendation-message correct">
											<Icons.CheckCircle />
											<span>هذا هو العدد المتوقع للصيفي {CONSTANTS.RECOMMENDED_SEMESTER_NAME}</span>
										</div>
									) : (
										<div className="recommendation-message warning">
											<Icons.WarningCircle />
											<span>العدد الموصى به هو {CONSTANTS.RECOMMENDED_WEEKS} أسابيع.</span>
										</div>
									)}
								</div>

								<div className="settings-section">
									<h3 className="settings-section-title">مظهر التطبيق</h3>
									<div className="settings-item">
										<h4>الوضع</h4>
										<div className="mode-toggle">
											<button className={`mode-btn ${colorMode === 'dark' ? 'active' : ''}`} onClick={() => setColorMode('dark')}>ظلام</button>
											<button className={`mode-btn ${colorMode === 'light' ? 'active' : ''}`} onClick={() => setColorMode('light')}>نهار</button>
										</div>
									</div>
									<div className="settings-item">
										<h4>اختر السمة</h4>
										<div className="theme-picker">
											{Object.entries(PRESET_THEMES).map(([name, color]) => (
												<div key={name} className={`theme-dot ${theme === color ? 'active' : ''}`} style={{ backgroundColor: color }} onClick={() => setTheme(color)} />
											))}
											<label htmlFor="custom-color-picker-modal" className={`color-picker-label ${isCustomTheme ? 'active' : ''}`} title="اختر لونًا مخصصًا" style={{ backgroundColor: isCustomTheme ? theme : 'transparent' }}>
												<input id="custom-color-picker-modal" type="color" className="color-picker-input" value={theme} onChange={(e) => setTheme(e.target.value)} />
											</label>
										</div>
									</div>
								</div>

								<div className="data-management-zone">
									<div className="settings-item">
										<div>
											<h4>بدء فصل دراسي جديد</h4>
											<p>هذا الإجراء سيقوم بحذف جميع المقررات المحفوظة بشكل نهائي.</p>
										</div>
										<button onClick={handleResetAll} className="data-management-zone-btn">مسح والبدء من جديد</button>
									</div>
								</div>
							</div>
						</SettingsModal>

						<footer className="footer">
							<span className="footer-link-text">© 2025 | ظلام</span>
							<div className="footer-controls">
								{installPrompt && (
									<button onClick={handleInstallClick} className="footer-icon-btn" title="تثبيت التطبيق">
										<Icons.Download />
									</button>
								)}
								<button onClick={() => setIsSettingsOpen(true)} className="footer-icon-btn" title="الإعدادات">
									<Icons.Settings />
								</button>
								<a href="https://t.me/mutlaq1" className="footer-icon-btn" target="_blank" rel="noopener noreferrer" title="تواصل معي على تليجرام">
									<Icons.Telegram />
								</a>
							</div>
						</footer>
					</div>
				</div>
			);
		}
		
		const root = ReactDOM.createRoot(document.getElementById("root"));
		root.render(<StrictMode><App /></StrictMode>);
	</script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const initCosmicEffects = () => {
            const canvas = document.getElementById('starfield-canvas'); if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let stars = [], shootingStars = [], scrollSpeed = 0, lastScrollY = window.scrollY;
            let mouseX = 0, mouseY = 0;

            function resizeCanvas() { 
                canvas.width = window.innerWidth; 
                canvas.height = window.innerHeight; 
            }

            window.addEventListener('mousemove', e => {
                mouseX = e.clientX - canvas.width / 2;
                mouseY = e.clientY - canvas.height / 2;
            });
            
            class Star { 
                constructor() {
                    this.depth = Math.random() * 0.9 + 0.1;
                    this.reset();
                    this.pulsate = Math.random() > 0.98;
                    this.alpha = 0;
                    this.alphaChange = (Math.random() * 0.02) + 0.005;
					this.vx = (Math.random() - 0.5) * 0.1 * this.depth;
                    this.vy = (Math.random() - 0.5) * 0.1 * this.depth;
                }
                reset() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.radius = (Math.random() * 1.2 + 0.3) * this.depth;
                    this.maxAlpha = (Math.random() * 0.5 + 0.3) * this.depth;
                }
                draw() {
                    const parallaxX = (mouseX / (canvas.width / 2)) * -25 * this.depth;
                    const parallaxY = (mouseY / (canvas.height / 2)) * -25 * this.depth;

                    if (this.pulsate) { 
                        this.alpha += this.alphaChange; 
                        if (this.alpha >= this.maxAlpha || this.alpha <= 0) this.alphaChange *= -1; 
                    } else { 
                        this.alpha = this.maxAlpha; 
                    }
                    ctx.globalAlpha = this.alpha;
                    ctx.beginPath();
                    ctx.arc(this.x + parallaxX, this.y + parallaxY, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `hsl(220, 80%, 95%)`;
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
                update() {
                    this.y += (scrollSpeed * this.depth) + this.vy; 
					this.x += this.vx;

					if (this.x > canvas.width + this.radius) this.x = -this.radius;
					if (this.x < -this.radius) this.x = canvas.width + this.radius;
                    if (this.y > canvas.height + this.radius) this.y = -this.radius;
                    if (this.y < -this.radius) this.y = canvas.height + this.radius;

                    this.draw();
                }
            }

            class ShootingStar { constructor() { this.reset(); } reset() { this.x = Math.random() * canvas.width; this.y = 0; this.len = Math.random() * 80 + 10; this.speed = Math.random() * 10 + 6; this.size = Math.random() * 1 + 0.1; this.waitTime = new Date().getTime() + Math.random() * 3000 + 500; this.active = false; } update() { if (this.active) { this.x -= this.speed; this.y += this.speed; if (this.x < 0 || this.y >= canvas.height) this.reset(); } else if (this.waitTime < new Date().getTime()) this.active = true; } draw() { if (this.active) { ctx.strokeStyle = `hsla(220, 100%, 80%, ${Math.random() * 0.5 + 0.5})`; ctx.lineWidth = this.size; ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(this.x + this.len, this.y - this.len); ctx.stroke(); } } }
            
            function initStars() { 
                stars = []; 
                shootingStars = []; 
                const starCount = Math.floor(canvas.width * canvas.height / 8000); 
                for (let i = 0; i < starCount; i++) { stars.push(new Star()); } 
                for (let i = 0; i < 3; i++) { shootingStars.push(new ShootingStar()); } 
            }

            function animate() { 
                requestAnimationFrame(animate); 
                ctx.clearRect(0, 0, canvas.width, canvas.height); 
                stars.forEach(s => s.update()); 
                shootingStars.forEach(s => { s.update(); s.draw(); }); 
                scrollSpeed *= 0.9; 
            }

            window.addEventListener('scroll', () => { 
                const delta = window.scrollY - lastScrollY; 
                scrollSpeed += delta * 0.03;
                lastScrollY = window.scrollY; 
            });

            window.addEventListener('resize', () => { 
                resizeCanvas(); 
                initStars(); 
            });
            
            resizeCanvas(); 
            initStars(); 
            animate();
        };

        initCosmicEffects();
    });
    </script>
</body>
</html>
